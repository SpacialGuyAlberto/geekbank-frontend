<!-- src/app/gift-card-details/gift-card-details.component.html -->
<div class="graph-container">
  <canvas id="graphCanvas"></canvas> <!-- Canvas para el fondo animado -->
</div>

<!-- Contenedor del Banner Dinámico -->
<div *ngIf="giftCard" class="banner" [ngStyle]="{'background-image': 'url(' + giftCard.coverImageOriginal + ')'}">
  <div class="banner-content">
  </div>
</div>


<div *ngIf="giftCard" class="gift-card-details-container">
  <div class="gift-card-image-container">
    <!-- Corazón y estrellas de feedback -->

    <div class="genre-container">
      <div *ngFor="let genre of giftCard.genres" class="genre">
        <p>{{genre}}</p>
      </div>
    </div>

    <div class="feedback-section">
      <button class="wishlist-button"
              [ngClass]="{'wished': giftCard.wished}"
              (click)="toggleWishList(giftCard, $event)"
              aria-label="Agregar a Wishlist">
        <span class="material-icons">
          favorite
        </span>
      </button>

      <div class="star-rating">
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
      </div>
    </div>
    <button class="arrow left"  aria-label="Imagen Anterior">
      <span class="material-icons"  (click)="previousImage()" >arrow_back</span>
    </button>

    <button class="arrow right"  aria-label="Imagen Siguiente">
      <span class="material-icons" (click)="nextImage()">arrow_forward</span>
    </button>

    <img *ngIf="currentImage" [src]="currentImage" alt="{{ giftCard.name }}" class="gift-card-image">



    <div class="add-info-content">
      <h3 class="add-info-title">Platforms</h3>
      <p class="highlight-card-type">Android</p>
      <p class="highlight-card-platform">Xbox</p>
    </div>
  </div>

  <div class="gift-card-info-card">
    <h2 class="gift-card-region">
      <i class="material-icons check-icon">check_circle</i>
      {{ giftCard.regionalLimitations }}
    </h2>

    <h2 class="gift-card-title">{{ giftCard.name }}</h2>
    <div class="gift-card-price">
      {{ (giftCard.price * exchangeRate).toFixed(2) | currency: 'HNL. ' }}
    </div>

    <div class="button-container">
      <button (click)="buyNow(giftCard)" class="btn buy-now">
        <i class="material-icons">shopping_bag</i>
        Comprar Ahora
      </button>
      <button (click)="toggleCart(giftCard)" class="btn add-to-cart">
        <i class="material-icons">{{ isInCart ? 'remove_shopping_cart' : 'add_shopping_cart' }}</i>
        {{ isInCart ? 'Eliminar del Carrito' : 'Agregar al Carrito' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal de Feedback -->
<div class="modal" *ngIf="isFeedbackModalOpen">
  <div class="modal-content">
    <span class="close-button" (click)="closeFeedbackModal()">&times;</span>
    <h2>Deja tu Feedback</h2>
    <form (ngSubmit)="submitFeedback(feedbackForm)" #feedbackForm="ngForm">
      <!-- Puntuación (Score) -->
      <div class="form-group">
        <label >Calificación:</label>
        <div class="star-rating-input">
          <i
            class="material-icons star-input"
            *ngFor="let star of [1,2,3,4,5]"
            [class.filled]="star <= feedbackScore"
            (click)="feedbackScore = star"
          >
            {{ star <= feedbackScore ? 'star' : 'star_border' }}
          </i>
        </div>
        <input type="hidden" name="score" [(ngModel)]="feedbackScore" required />
      </div>
      <!-- Mensaje -->
      <div class="form-group">
        <label for="feedbackMessage">Mensaje:</label>
        <textarea
          id="feedbackMessage"
          name="feedbackMessage"
          [(ngModel)]="feedbackMessage"
          rows="5"
          placeholder="Escribe tu comentario..."
          required
          maxlength="500"
        ></textarea>
      </div>
      <!-- Botones de Acción -->
      <div class="form-actions">
        <button type="submit" [disabled]="!feedbackForm.form.valid">Enviar</button>
        <button type="button" (click)="closeFeedbackModal()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<div class="suggestions-container" style="position: relative;">
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="bars">
      <div class="bar bar1"></div>
      <div class="bar bar2"></div>
      <div class="bar bar3"></div>
      <div class="bar bar4"></div>
      <div class="bar bar5"></div>
    </div>
  </div>

  <div *ngIf="!isLoading">
    <app-suggestions [kinguinId]="kinguinId"></app-suggestions>
  </div>
</div>

<div class="tabs-container">
  <div class="tab" [class.active]="activeTab === 'description'" (click)="setActiveTab('description')">
    Description
  </div>
  <div class="tab" [class.active]="activeTab === 'activation'" (click)="setActiveTab('activation')">
    Detalles de activacion
  </div>
  <div class="tab" [class.active]="activeTab === 'requirements'" (click)="setActiveTab('requirements')">
    Requisitos del sistema
  </div>
  <div class="tab" [class.active]="activeTab === 'languages'" (click)="setActiveTab('languages')">
    Idiomas
  </div>
</div>

<div class="tab-content">
  <div *ngIf="activeTab === 'description'">
    <p>{{giftCard?.description}}.</p>
  </div>
  <div *ngIf="activeTab === 'activation'">
    <p>{{giftCard?.activationDetails}}</p>
  </div>
  <div *ngIf="activeTab === 'requirements'">
    <div *ngFor="let requirement of giftCard?.systemRequirements">
      <h3>{{requirement.system}}</h3>
      <ul>
        <li *ngFor="let req of requirement.requirement">{{req}}</li>
      </ul>
    </div>
  </div>
  <div *ngIf="activeTab === 'languages'">
    <div *ngFor="let country of giftCardLanguages" class="language-item">
      <img [src]="country.image" alt="{{ country.name }} flag" class="language-flag">
      <span>{{ country.code }}</span>
    </div>
  </div>
</div>
