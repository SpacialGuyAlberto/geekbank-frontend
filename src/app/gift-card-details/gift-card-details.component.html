<div class="graph-container">
  <canvas id="graphCanvas"></canvas> <!-- Canvas para el fondo animado -->
</div>

<div *ngIf="giftCard" class="gift-card-details-container">
  <div class="gift-card-image-container">
    <!-- Coraz贸n y estrellas de feedback -->
    <div class="feedback-section">
      <i class="material-icons heart-icon">favorite_border</i>
      <div class="star-rating">
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
        <i class="material-icons star" (click)="openFeedbackModal()">star_border</i>
      </div>
    </div>
    <img [src]="giftCard.coverImageOriginal" alt="{{ giftCard.name }}" class="gift-card-image">
    <div class="add-info-content">
      <h3 class="add-info-title">Platforms</h3>
      <p class="highlight-card-type">Android</p>
      <p class="highlight-card-platform">Xbox</p>
    </div>
  </div>

  <div class="gift-card-info-card">
    <h2 class="gift-card-region">
      <i class="material-icons check-icon">check_circle</i>
      {{ giftCard.regionalLimitations }}
    </h2>

    <h2 class="gift-card-title">{{ giftCard.name }}</h2>
    <div class="gift-card-price" [ngModel]="exchangeRate">
      {{ (giftCard.price * exchangeRate).toFixed(2) | currency }}
    </div>

    <div *ngIf="isLoggedIn(); else notLoggedInMessage" class="button-container">
      <button (click)="toggleCart(giftCard)" class="btn add-to-cart">
        <i class="material-icons">{{ isInCart ? 'remove_shopping_cart' : 'add_shopping_cart' }}</i>
        {{ isInCart ? 'Eliminar del Carrito' : 'Agregar al Carrito' }}
      </button>
      <button (click)="buyNow(giftCard)" class="btn buy-now">
        <i class="material-icons">shopping_bag</i>
        Comprar Ahora
      </button>
    </div>

    <ng-template #notLoggedInMessage>
      <div class="not-logged-in-message">
        <h2>You are not logged in.</h2>
        <p>Please log in to add products to the cart.</p>
        <button (click)="redirectToLogin()" class="btn login-btn">
          <i class="material-icons">login</i>
          Log in
        </button>
      </div>
    </ng-template>
  </div>
</div>

<!-- Modal de Feedback -->
<div class="modal" *ngIf="isFeedbackModalOpen">
  <div class="modal-content">
    <span class="close-button" (click)="closeFeedbackModal()">&times;</span>
    <h2>Deja tu Feedback</h2>
    <form (ngSubmit)="submitFeedback(feedbackForm)" #feedbackForm="ngForm">
      <!-- Puntuaci贸n (Score) -->
      <div class="form-group">
        <label for="feedbackScore">Calificaci贸n:</label>
        <div class="star-rating-input">
          <i
            class="material-icons star-input"
            *ngFor="let star of [1,2,3,4,5]"
            [class.filled]="star <= feedbackScore"
            (click)="feedbackScore = star"
          >
            {{ star <= feedbackScore ? 'star' : 'star_border' }}
          </i>
        </div>
        <input type="hidden" name="score" [(ngModel)]="feedbackScore" required />
      </div>
      <!-- Mensaje -->
      <div class="form-group">
        <label for="feedbackMessage">Mensaje:</label>
        <textarea
          id="feedbackMessage"
          name="feedbackMessage"
          [(ngModel)]="feedbackMessage"
          rows="5"
          placeholder="Escribe tu comentario..."
          required
          maxlength="500"
        ></textarea>
      </div>
      <!-- Botones de Acci贸n -->
      <div class="form-actions">
        <button type="submit" [disabled]="!feedbackForm.form.valid">Enviar</button>
        <button type="button" (click)="closeFeedbackModal()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

