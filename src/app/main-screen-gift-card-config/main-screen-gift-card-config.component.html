<div class="gift-card-dashboard">
  <div class="header">
    <h1>Configuración de Tarjetas de Regalo</h1>

    <button (click)="toggleViewMode()" class="toggle-view-btn">
      <i class="fas" [ngClass]="{ 'fa-th-large': !isListView, 'fa-list': isListView }"></i>
      Vista: {{ isListView ? 'Lista' : 'Tarjetas' }}
    </button>
  </div>

  <div class="main-content">
    <!-- ========== PANEL IZQUIERDO (BUSCADOR / RESULTADOS) ========== -->
    <div class="left-panel">
      <div class="search-bar-container">
        <app-search-bar
          (searchResults)="handleSearchResults($event)"
          class="search-bar">
        </app-search-bar>
      </div>

      <h2>Resultados de Búsqueda</h2>

      @if (!isListView) {
        <div class="gift-cards-container">
          @for (card of giftCards; track giftCards.values()) {
            <div class="gift-card">
              <div class="gift-card-image-container">
                <img [src]="bestImageUrls[card.kinguinId] || card.coverImage" alt="{{ card.name }}" class="gift-card-image" />
                <button class="add-gift-card-btn" (click)="addToGiftCards(card)">
                  <i class="fas fa-plus-circle"></i>
                </button>
              </div>
              <div class="gift-card-content">
                <h3 class="gift-card-title">{{ card.name }}</h3>
                <div class="gift-card-price">
                  <span>{{ card.price | currency }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="gift-cards-list">
          @for (card of giftCards; let i = $index; track giftCards.values()) {
            <div class="list-item">
              <div class="list-index">#{{ i + 1 }}</div>
              <div class="list-name">{{ card.name }}</div>
              <div class="list-price">{{ card.price | currency }}</div>
              <button class="list-add-btn" (click)="addToGiftCards(card)">
                <i class="fas fa-plus-circle"></i>
              </button>
            </div>
          }
        </div>
      }
    </div>

    <!-- ========== PANEL DERECHO (DESTACADAS / CLASIFICACIÓN) ========== -->
    <div class="right-panel">
      <div class="right-panel-header">
        <h2>Mis Tarjetas de Regalo Destacadas</h2>

        <!-- Filtro por clasificación -->
        <select [(ngModel)]="selectedFilter" class="classification-filter">
          <option [ngValue]="'ALL'">Todas</option>
          @for (key of classificationKeys; track classificationKeys.values()) {
            <option [ngValue]="key">{{ key }}</option>
          }
        </select>
      </div>

      @if (!isListView) {
        <!-- Vista GRID usando DTOs filtrados -->
        <div class="gift-cards-container">
          @for (item of filteredMainScreenGiftCardItems; track item.mainScreenGiftCardItem.id) {
            <div class="gift-card">
              <div class="gift-card-image-container">
                <img [src]="bestImageUrls[item.giftcard.kinguinId] || item.giftcard.coverImage"
                     alt="{{ item.giftcard.name }}"
                     class="gift-card-image" />
                <button class="remove-gift-card-btn" (click)="removeFromGiftCards(item.giftcard)">
                  <i class="fas fa-minus-circle"></i>
                </button>
              </div>
              <div class="gift-card-content">
                <h3 class="gift-card-title">{{ item.giftcard.name }}</h3>
                <div class="gift-card-price">
                  <span>{{ item.giftcard.price | currency }}</span>
                </div>
                <div class="gift-card-classification">
                  Clasificación: {{ item.mainScreenGiftCardItem.classification }}
                </div>
              </div>
            </div>
          }
        </div>
      } @else {
        <!-- Vista LISTA usando DTOs filtrados -->
        <div class="gift-cards-list">
          @for (item of filteredMainScreenGiftCardItems; let i = $index; track item.mainScreenGiftCardItem.id) {
            <div class="list-item">
              <div class="list-index">#{{ i + 1 }}</div>
              <div class="list-name">{{ item.giftcard.name }}</div>
              <div class="list-price">{{ item.giftcard.price | currency }}</div>
              <div class="list-classification">
                {{ item.mainScreenGiftCardItem.classification }}
              </div>
              <button class="list-remove-btn" (click)="removeFromGiftCards(item.giftcard)">
                <i class="fas fa-minus-circle"></i>
              </button>
            </div>
          }
        </div>
      }
    </div>

    <!-- ========== PAGINACIÓN ========== -->
    <div class="pagination">
      <button class="pagination-btn" (click)="onPrevPage()">Anterior</button>
      <span class="pagination-info">
        Página {{ currentPage + 1 }} de {{ totalPages }}
      </span>
      <button class="pagination-btn" (click)="onNextPage()">Siguiente</button>
    </div>
  </div>

  <!-- ========== MODAL DE CLASIFICACIÓN ========== -->
  @if (showClassificationModal) {
    <div class="modal-backdrop"></div>
    <div class="modal">
      <h2>Selecciona una Clasificación</h2>
      <select [(ngModel)]="selectedClassification">
        @for (key of classificationKeys; track classificationKeys.values()) {
          <option [value]="key">{{ key }}</option>
        }
      </select>
      <div class="modal-actions">
        <button class="modal-btn confirm" (click)="confirmClassification()">Confirmar y Guardar</button>
        <button class="modal-btn cancel" (click)="cancelClassification()">Cancelar</button>
      </div>
    </div>
  }
</div>
