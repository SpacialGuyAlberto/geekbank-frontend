<nav [ngClass]="navbarClass" *ngIf="showNavbar" [class.is-scrolled]="isScrolled" class="navbar">
  <div class="navbar-container">
    <div class="navbar-left">
      <div class="brand" (click)="goToHome()">
        <div class="brand-logo">
          <!-- Placeholder logo gradient or actual image if provided -->
          <img src="assets/logo.png" alt="Astralis" onerror="this.style.display='none'">
          <span *ngIf="true" style="font-weight: 900; font-size: 1.2rem; color: #fff;">A</span>
        </div>
        <div class="brand-text">
          <span class="brand-name">Astralis</span>
          <span class="brand-tag">Premium Marketplace</span>
        </div>
      </div>
    </div>

    <div class="navbar-center" *ngIf="!isSmallScreen">
      <!-- Primary nav links if any -->
    </div>

    <div class="navbar-right">
      <div class="nav-actions">
        <!-- Auth Links -->
        <ng-container *ngIf="!(isAuthenticated$ | async)">
          <a (click)="goToLogin()" class="nav-link">Iniciar sesión</a>
          <a routerLink="/register" class="nav-link">Registrarse</a>
        </ng-container>

        <!-- User Menu / Cart -->
        <div class="icon-group">
          <div class="icon-btn-wrapper" (mouseenter)="onCartHover()">
            <a routerLink="/cart" class="icon-btn">
              <i class="fa-solid fa-cart-shopping"></i>
              <span *ngIf="cartItemCount > 0" class="cart-count">{{ cartItemCount }}</span>
            </a>
          </div>

          <!-- Add other user icons here as needed -->
          <button *ngIf="(isAuthenticated$ | async)" (click)="logout()" class="icon-btn" title="Cerrar sesión">
            <i class="fa-solid fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>

<div class="navbar-categories" *ngIf="!isSmallScreen && showNavbar" [class.is-scrolled]="isScrolled">
  <div class="categories-content-wrapper">
    <div class="category-menu-container">
      <div class="dropdown" (mouseenter)="onDropdownMouseEnter()" (mouseleave)="onDropdownMouseLeave()">
        <button class="nav-link dropdown-toggle" aria-haspopup="true">
          <i class="fas fa-th-list"></i> Categorías
        </button>
        <div class="dropdown-content aurora-card" role="menu" *ngIf="isDropdownHovered" style="z-index: 1001;">
          <div class="dropdown-items">
            <a *ngFor="let genre of genres" (click)="onSelectGenre(genre.key)" class="nav-link">
              {{ genre.label }}
            </a>
          </div>
          <app-category-items *ngIf="selectedGenre" [selectedCategory]="selectedGenre" class="app-category-items">
          </app-category-items>
        </div>
      </div>

      <button class="nav-link" (click)="navigateToPurchaseConfirmation()">
        <i class="fa-solid fa-bag-shopping"></i> Mis compras
      </button>

      <button class="nav-link" [routerLink]="['/filtered/Software']" (click)="selectCategory('software')">
        <i class="fas fa-laptop-code"></i> Software
      </button>
    </div>

    <div class="sub-navbar-search">
      <app-search-bar (searchResults)="handleSearchResults($event)"></app-search-bar>
    </div>
  </div>
</div>

<!-- Modales -->
<div class="search-modal" *ngIf="showSearchModal">
  <div class="search-modal-content">
    <span class="close-modal" (click)="closeSearchModal()">&times;</span>
    <app-search-bar (searchResults)="[closeSearchModal(), handleSearchResults($event)]"
      (isFreeFireSearch)="handleFreeFireSearch($event)"></app-search-bar>
    <p *ngIf="searchResultsMessage">{{ searchResultsMessage }}</p>
  </div>
</div>

<div class="menu-modal" *ngIf="showMenuModal">
  <div class="menu-modal-content">
    <span class="close-modal" (click)="closeMenuModal()">&times;</span>
    <div class="menu-links">
      <ul>
        <li [ngClass]="userMenu" *ngIf="(isAuthenticated$ | async) && isSmallScreen && !inUserDetailsRoute"
          (click)="closeMenuModal()">
          <a routerLink="/user-details" (click)="closeMenuModal()" class="menu-link">
            <i class="fa-solid fa-user clickable-icon"></i>
            Informacion de Usuario
          </a>
        </li>
        <li [ngClass]="userMenu" *ngIf="(isAuthenticated$ | async) && isSmallScreen && !inUserDetailsRoute"
          (click)="closeMenuModal()">
          <app-balance *ngIf="(isAuthenticated$ | async)"></app-balance>
        </li>
        <li [ngClass]="userMenu" *ngIf="isSmallScreen && inUserDetailsRoute">
          <button (click)="toggleUserTabs()" [attr.aria-expanded]="tabsExpanded">
            <i class="fas fa-th-list"></i> User Settings
            <i class="fas" [ngClass]="{'fa-chevron-down': !tabsExpanded, 'fa-chevron-up': tabsExpanded}"></i>
          </button>
          <ul class="submenu" *ngIf="tabsExpanded">
            <li><a href="/user-details" (click)="selectCategory('user-info'); closeMenuModal()">User Info</a></li>
            <li><a href="/address" (click)="selectCategory('address'); closeMenuModal()">Address</a></li>
            <li><a href="/payment-methods" (click)="selectCategory('payment-methods'); closeMenuModal()">Payment
                method</a></li>
            <li><a href="/preferences" (click)="selectCategory('preferences'); closeMenuModal()">Preferences</a></li>
            <li><a href="/orders" (click)="selectCategory('orders'); closeMenuModal()">Transactions</a></li>
            <li><a href="/wish-list" (click)="selectCategory('wish-list'); closeMenuModal()">Wish List</a></li>
            <li *ngIf="(isAuthenticated$ | async) && role === 'ADMIN'"><a href="/admin-panel"
                (click)="selectCategory('admin-panel'); closeMenuModal()">Admin Dashboard</a></li>
          </ul>
        </li>
        <li *ngIf="!(isAuthenticated$ | async)">
          <a routerLink="/login" class="menu-link" (click)="closeMenuModal()">Iniciar sesión</a>
        </li>
        <li *ngIf="!(isAuthenticated$ | async)">
          <a routerLink="/register" class="menu-link" (click)="closeMenuModal()">Registrarse</a>
        </li>
        <li>
          <a routerLink="/cart" class="menu-link" (click)="closeMenuModal()">
            <i class="fa-solid fa-cart-shopping"></i>
            <span *ngIf="cartItemCount > 0">({{ cartItemCount }})</span>
            Carrito
          </a>
        </li>
        <li>
          <a class="menu-link" (click)="[navigateToPurchaseConfirmation(), closeMenuModal()]">
            <i class="fa-solid fa-bag-shopping"></i>
            Mis compras
          </a>
        </li>

        <!-- Categorías en el menu-modal para pantallas pequeñas -->
        <li class="sub-menu" *ngIf="isSmallScreen">
          <button (click)="toggleCategories()" [attr.aria-expanded]="categoriesExpanded">
            <i class="fas fa-th-list"></i> Categorías
            <i class="fas"
              [ngClass]="{'fa-chevron-down': !categoriesExpanded, 'fa-chevron-up': categoriesExpanded}"></i>
          </button>
          <ul class="submenu" *ngIf="categoriesExpanded">
            <li *ngFor="let category of genres">
              <a [routerLink]="['/filtered', category.key]" (click)="selectCategory(category.key); closeMenuModal()">
                {{ category.label }}
              </a>
            </li>

          </ul>

        </li>
        <!--        <li>-->
        <!--          <a routerLink="/random-keys" class="menu-link">-->
        <!--            <i class="fas fa-random" aria-hidden="true"></i> Claves Aleatorias-->
        <!--          </a>-->
        <!--        </li>-->
        <li>
          <a class="menu-link" [routerLink]="['/filtered/Software']">
            <i class="fas fa-laptop-code" aria-hidden="true"></i> Software
          </a>
        </li>
        <li *ngIf="(isAuthenticated$ | async)" (click)="logout(); closeMenuModal()">
          <a class="menu-link">
            <i class="fa-solid fa-sign-out-alt clickable-icon"></i>
            Log out
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>