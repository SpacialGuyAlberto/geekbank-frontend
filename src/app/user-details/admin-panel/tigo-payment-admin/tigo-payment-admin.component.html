<!-- src/app/components/tigo-payment-admin/tigo-payment-admin.component.html -->

<div class="manual-sales-container">
  <h2>Administración de Pagos Tigo</h2>

  <!-- Botón para Crear Nuevo Pago -->
  <div style="text-align: center; margin-top: 2rem;">
    <button class="complete-sale-btn" (click)="openCreateModal()">
      <i class="fa fa-plus"></i> Crear Nuevo Pago
    </button>
  </div>

  <!-- Estado de Conexión -->
  <div class="connection-status" *ngIf="isLoading">
    <i class="fa fa-spinner fa-spin"></i> Cargando...
  </div>
  <div class="no-transactions" *ngIf="!isLoading && payments.length === 0">
    No hay pagos no coincidentes disponibles.
  </div>

  <!-- Contenedor de la Tabla -->
  <div class="table-container" *ngIf="!isLoading && payments.length > 0">
    <table class="sales-table">
      <thead>
      <tr>
        <th>ID</th>
        <th>Número de Teléfono</th>
        <th>Monto Recibido</th>
        <th>Número de Referencia</th>
        <th>Recibido At</th>
        <th>Consumido</th>
        <th>Diferencia Redimida</th>
        <th>Verificado</th>
        <th>Imagen</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let payment of payments">
        <td data-label="ID de Transacción">{{ payment.id }}</td>
        <td data-label="Número de Teléfono">{{ payment.phoneNumber }}</td>
        <td data-label="Monto Recibido">{{ payment.amountReceived | currency }}</td>
        <td data-label="Número de Referencia">{{ payment.referenceNumber }}</td>
        <td data-label="Recibido At">{{ payment.receivedAt | date:'short' }}</td>
        <td data-label="Consumido">
          <input type="checkbox" [checked]="payment.consumed" (change)="toggleConsumed(payment)" />
        </td>
        <td data-label="Diferencia Redimida">
          <input type="checkbox" [checked]="payment.differenceRedeemed" (change)="toggleDifferenceRedeemed(payment)" />
        </td>
        <td data-label="Verificado">
          <input type="checkbox" [checked]="payment.verified" (change)="toggleVerified(payment)" />
        </td>
        <td data-label="Imagen">
          <img *ngIf="payment.imageBase64" [src]="payment.imageBase64" alt="Imagen de Pago" width="50" height="50" />
          <span *ngIf="!payment.imageBase64">No Disponible</span>
        </td>
        <td data-label="Acciones">
          <button class="complete-sale-btn" (click)="openEditModal(payment)">
            <i class="fa fa-edit"></i> Editar
          </button>
          <button class="complete-sale-btn" (click)="deletePayment(payment.id)">
            <i class="fa fa-trash"></i> Eliminar
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>



  <!-- Modal para Crear/Editar Pago -->
  <div class="modal" *ngIf="isModalOpen">
    <div class="modal-content">
      <span class="close-btn" (click)="closeModal()">&times;</span>
      <h3>{{ isEditMode ? 'Editar Pago' : 'Crear Nuevo Pago' }}</h3>
      <form (ngSubmit)="onSubmit()" #paymentForm="ngForm">
        <div>
          <label for="phoneNumber">Número de Teléfono:</label>
          <input type="text" id="phoneNumber" required [(ngModel)]="selectedPayment.phoneNumber" name="phoneNumber" />
        </div>
        <div>
          <label for="amountReceived">Monto Recibido:</label>
          <input type="number" id="amountReceived" required [(ngModel)]="selectedPayment.amountReceived" name="amountReceived" />
        </div>
        <div>
          <label for="referenceNumber">Número de Referencia:</label>
          <input type="text" id="referenceNumber" required [(ngModel)]="selectedPayment.referenceNumber" name="referenceNumber" />
        </div>
        <div>
          <label for="receivedAt">Recibido At:</label>
          <input type="datetime-local" id="receivedAt" required [(ngModel)]="selectedPayment.receivedAt" name="receivedAt" />
        </div>
        <div>
          <label for="consumed">Consumido:</label>
          <input type="checkbox" id="consumed" [(ngModel)]="selectedPayment.consumed" name="consumed" />
        </div>
        <div>
          <label for="differenceRedeemed">Diferencia Redimida:</label>
          <input type="checkbox" id="differenceRedeemed" [(ngModel)]="selectedPayment.differenceRedeemed" name="differenceRedeemed" />
        </div>
        <div>
          <label for="verified">Verificado:</label>
          <input type="checkbox" id="verified" [(ngModel)]="selectedPayment.verified" name="verified" />
        </div>
        <div>
          <label for="image">Imagen:</label>
          <input type="file" id="image" (change)="onFileSelected($event)" accept="image/*" />
          <div *ngIf="selectedPayment.imageBase64">
            <img [src]="selectedPayment.imageBase64" alt="Imagen Seleccionada" width="100" height="100" />
          </div>
        </div>
        <div style="margin-top: 1rem; text-align: center;">
          <button type="submit" class="complete-sale-btn">{{ isEditMode ? 'Actualizar' : 'Crear' }}</button>
        </div>
      </form>
    </div>
  </div>

</div>
