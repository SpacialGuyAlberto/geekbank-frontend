<div class="products-dashboard">
  <div class="top-controls">
    <div class="search-bar">
      <input type="text" placeholder="Buscar producto..." [(ngModel)]="searchQuery" (input)="searchProducts()" />
      <i class="fas fa-search"></i>
    </div>
    <button class="add-product-btn" (click)="addProduct()" *ngIf="!createNewProduct">
      <i class="fas fa-plus-circle"></i> Nuevo Producto
    </button>
  </div>

  <div class="main-content">
    <div class="products-list" #productsList [ngClass]="{'full-grid': !selectedProduct}">
      <h2>Productos</h2>
      <div class="product-cards-list">
        <div *ngFor="let product of filteredProducts"
             class="product-card"
             (click)="toggleProductDetails(product)"
             [ngClass]="{'selected' : product === selectedProduct}">
          <div class="product-image">
            <!-- Reemplaza 'product.imageUrl' por la propiedad correcta de tu producto -->
            <img [src]="product.imageUrl || 'assets/default-product.png'" alt="{{ product.name }}">
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p>Precio: {{ product.price | currency }}</p>
          </div>
        </div>
      </div>

      <div class="pagination">
        <button (click)="goToPage(1)" [disabled]="currentPage === 1">
          <i class="fas fa-angle-double-left"></i>
        </button>
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
          <i class="fas fa-angle-left"></i>
        </button>
        <span *ngFor="let page of [currentPage-2, currentPage-1, currentPage, currentPage+1, currentPage+2]">
          <button *ngIf="page > 0 && page <= totalPages"
                  (click)="goToPage(page)"
                  [class.active]="page === currentPage">
            {{ page }}
          </button>
        </span>
        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
          <i class="fas fa-angle-right"></i>
        </button>
        <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
    </div>

    <!-- Resizer entre la lista de productos y los detalles -->
    <div class="resizer" #resizer></div>

    <div class="product-details" *ngIf="selectedProduct" [ngClass]="{'visible': selectedProduct}">
      <button class="close-btn" (click)="closeProductDetails()">
        <i class="fas fa-times"></i>
      </button>

      <h2>Detalles de {{ selectedProduct?.name }}</h2>

      <div class="product-info-details">
        <dl>
          <div class="detail-item">
            <dt>Precio:</dt>
            <dd>{{ selectedProduct?.price | currency }}</dd>
          </div>
          <div class="detail-item">
            <dt>Descripción:</dt>
            <dd>{{ selectedProduct?.description }}</dd>
          </div>
          <div class="detail-item">
            <dt>Plataforma:</dt>
            <dd>{{ selectedProduct?.platform }}</dd>
          </div>
          <div class="detail-item">
            <dt>Fecha de lanzamiento:</dt>
            <dd>{{ selectedProduct?.releaseDate | date:'longDate' }}</dd>
          </div>
          <div class="detail-item">
            <dt>Calificación por edad:</dt>
            <dd>{{ selectedProduct?.ageRating }}</dd>
          </div>
          <div class="detail-item">
            <dt>Limitaciones regionales:</dt>
            <dd>{{ selectedProduct?.regionalLimitations }}</dd>
          </div>
        </dl>

        <!-- Imagen principal del producto -->
        <div class="product-image-large">
          <img [src]="selectedProduct?.imageUrl || 'assets/default-product.png'" alt="Imagen del producto">
        </div>

        <!-- Requisitos del sistema -->
        <div *ngIf="selectedProduct?.systemRequirements?.length">
          <h3>Requisitos del sistema:</h3>
          <ul>
            <li *ngFor="let req of selectedProduct?.systemRequirements">
              <strong>{{ req.system }}:</strong> {{ req.requirement.join(', ') }}
            </li>
          </ul>
        </div>

        <!-- Ofertas del producto -->
        <div *ngIf="selectedProduct?.offers?.length">
          <h3>Ofertas disponibles:</h3>
          <table class="offers-table">
            <thead>
            <tr>
              <th>Nombre</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Vendedor</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let offer of selectedProduct?.offers">
              <td>{{ offer.name }}</td>
              <td>{{ offer.price | currency }}</td>
              <td>{{ offer.availableQty }}</td>
              <td>{{ offer.merchantName }}</td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- Imágenes adicionales -->
        <div *ngIf="selectedProduct?.screenshots?.length">
          <h3>Imágenes:</h3>
          <div class="screenshot-gallery">
            <img *ngFor="let screenshot of selectedProduct?.screenshots" [src]="screenshot.url" alt="Captura de pantalla">
          </div>
        </div>

        <!-- Videos -->
        <div *ngIf="selectedProduct?.videos?.length">
          <h3>Videos:</h3>
          <div class="video-gallery">
            <iframe *ngFor="let video of selectedProduct?.videos"
                    width="560"
                    height="315"
                    [src]="'https://www.youtube.com/embed/' + video.videoId"
                    frameborder="0"
                    allowfullscreen>
            </iframe>
          </div>
        </div>

        <!-- ======================================== -->
        <!-- Sección: Detalles de Activación (EDITAR) -->
        <!-- ======================================== -->
        <div class="details-activation-container">
          <h3>Detalles de Activación</h3>

          <div class="detail-item full-width">
            <dt>Video URL:</dt>
            <dd>
              <input type="text" [(ngModel)]="activationVideoUrl" />
            </dd>
          </div>

          <div class="detail-item full-width">
            <dt>Instrucciones:</dt>
            <dd>
              <textarea [(ngModel)]="activationTextDetails" rows="4"></textarea>
            </dd>
          </div>

          <div class="activation-details-actions">
            <button (click)="saveActivationDetails()">Guardar Detalles</button>
            <button (click)="deleteActivationDetails()">Eliminar Detalles</button>
          </div>
        </div>

      </div>
    </div>

    <div class="product-creation" *ngIf="createNewProduct">
      <!-- Aquí puedes incluir tu componente para crear nuevos productos -->
    </div>
  </div>
</div>
