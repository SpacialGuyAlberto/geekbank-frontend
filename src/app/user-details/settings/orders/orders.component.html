<!-- orders.component.html -->
<div class="transactions-container">
  <h2 class="section-title">Transacciones</h2>

  <!-- Indicador de Carga -->
  <div *ngIf="isLoading" class="loading-indicator">
    <p>Cargando transacciones...</p>
  </div>

  <!-- Mensaje de Error -->
  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Filtros -->
  <div class="filters" *ngIf="!isLoading && !errorMessage">
    <input type="text" placeholder="Buscar" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()">
    <select [(ngModel)]="selectedStatus" (ngModelChange)="onFilterChange()">
      <option value="">Estado</option>
      <option value="COMPLETED">Completado</option>
      <option value="REFUNDED">Reembolsado</option>
      <option value="PENDING">Pendiente</option>
      <option value="CANCELLED">Cancelado</option>
    </select>
    <input type="date" [(ngModel)]="dateFrom" (ngModelChange)="onFilterChange()" placeholder="Desde">
    <input type="date" [(ngModel)]="dateTo" (ngModelChange)="onFilterChange()" placeholder="Hasta">
    <button (click)="filterTransactions()">
      <i class="fas fa-filter"></i> Filtrar
    </button>
    <button (click)="resetFilters()">
      <i class="fas fa-times-circle"></i> Resetear
    </button>
  </div>

  <!-- Tabla de Transacciones -->
  <div class="transaction-table" *ngIf="!isLoading && !errorMessage">
    <div class="transaction-header">
      <span>Imagen</span>
      <span>Nombre</span>
      <span>ID de Transacción</span>
      <span>Fecha</span>
      <span>Estado</span>
      <span>Monto</span>
    </div>

    <!-- Fila por cada transacción paginada -->
    <div *ngFor="let transaction of paginatedTransactions">
      <div *ngFor="let product of transaction.products" class="transaction-row">
        <!-- Columna de Imagen -->
        <span class="image-column">
          <img
            *ngIf="product.image"
            [src]="product.image"
            [alt]="product.name || 'Producto'"
            class="product-image"
            loading="lazy"
          >
        </span>

        <!-- Nombre del Producto -->
        <span class="name-column">{{ product.name || 'Nombre no disponible' }}</span>

        <!-- ID de Transacción -->
        <span class="id-column">{{ transaction.transactionNumber }}</span>

        <!-- Fecha -->
        <span class="date-column">{{ transaction.timestamp | date:'dd-MM-yyyy HH:mm' }}</span>

        <!-- Estado -->
        <span [ngClass]="'transaction-status ' + transaction.status" class="status-column">{{ transaction.status }}</span>

        <!-- Monto -->
        <span class="amount-column">{{ transaction.amount | currency: "Lps. " }}</span>
      </div>
    </div>
  </div>

  <!-- Paginación -->
  <div class="pagination" *ngIf="!isLoading && !errorMessage && totalPages > 1">
    <button (click)="goToPage(1)" [disabled]="currentPage === 1">
      <i class="fas fa-angle-double-left"></i>
    </button>
    <button (click)="previousPage()" [disabled]="currentPage === 1">
      <i class="fas fa-angle-left"></i>
    </button>

    <!-- Mostrar botones de páginas alrededor de la página actual -->
    <span *ngFor="let page of getPageNumbers()">
      <button (click)="goToPage(page)" [class.active]="page === currentPage">{{ page }}</button>
    </span>

    <button (click)="nextPage()" [disabled]="currentPage === totalPages">
      <i class="fas fa-angle-right"></i>
    </button>
    <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
      <i class="fas fa-angle-double-right"></i>
    </button>
  </div>
</div>
